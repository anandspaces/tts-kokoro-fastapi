<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Socket.IO TTS Tester</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
</head>

<body class="bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 min-h-screen text-white">
  <div class="container mx-auto px-4 py-8 max-w-4xl">
    <div class="text-center mb-8">
      <h1 class="text-4xl font-bold mb-2 bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">
        ðŸŽ¤ Socket.IO TTS Tester
      </h1>
      <p class="text-slate-400">Test Multilingual & Sentiment TTS Sockets</p>
    </div>

    <!-- Connection Status -->
    <div class="grid grid-cols-2 gap-4 mb-8">
      <div class="bg-slate-800 rounded-lg p-4 border border-slate-700">
        <div class="flex items-center justify-between">
          <span class="font-semibold text-purple-400">Sentiment Socket</span>
          <div id="sentiment-status" class="w-3 h-3 rounded-full bg-red-500"></div>
        </div>
      </div>
      <div class="bg-slate-800 rounded-lg p-4 border border-slate-700">
        <div class="flex items-center justify-between">
          <span class="font-semibold text-pink-400">Multilingual Socket</span>
          <div id="multilingual-status" class="w-3 h-3 rounded-full bg-red-500"></div>
        </div>
      </div>
    </div>

    <!-- Sentiment TTS Form -->
    <div class="bg-slate-800 rounded-lg p-6 mb-6 border border-slate-700">
      <h2 class="text-2xl font-bold mb-4 text-purple-400">Sentiment TTS</h2>
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium mb-2">Text</label>
          <input type="text" id="sentiment-text"
            class="w-full px-4 py-2 bg-slate-900 border border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"
            placeholder="Enter text to synthesize" value="Hello world, this is a sentiment test">
        </div>
        <div>
          <label class="block text-sm font-medium mb-2">Language</label>
          <select id="sentiment-lang"
            class="w-full px-4 py-2 bg-slate-900 border border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
            <option value="english">English</option>
            <option value="hindi">Hindi</option>
            <option value="french">French</option>
            <option value="spanish">Spanish</option>
            <option value="german">German</option>
            <option value="chinese">Chinese</option>
            <option value="japanese">Japanese</option>
          </select>
        </div>
        <button id="sentiment-btn"
          class="w-full bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 px-6 py-3 rounded-lg font-semibold transition-all transform hover:scale-105">
          ðŸŽµ Synthesize Sentiment
        </button>
      </div>
    </div>

    <!-- Multilingual TTS Form -->
    <div class="bg-slate-800 rounded-lg p-6 mb-6 border border-slate-700">
      <h2 class="text-2xl font-bold mb-4 text-pink-400">Multilingual TTS</h2>
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium mb-2">Text</label>
          <input type="text" id="multilingual-text"
            class="w-full px-4 py-2 bg-slate-900 border border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500"
            placeholder="Enter text to synthesize" value="Hello world, this is a multilingual test">
        </div>
        <div>
          <label class="block text-sm font-medium mb-2">Language</label>
          <select id="multilingual-lang"
            class="w-full px-4 py-2 bg-slate-900 border border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500">
            <option value="english">English</option>
            <option value="hindi">Hindi</option>
            <option value="french">French</option>
            <option value="spanish">Spanish</option>
            <option value="german">German</option>
            <option value="chinese">Chinese</option>
            <option value="japanese">Japanese</option>
          </select>
        </div>
        <button id="multilingual-btn"
          class="w-full bg-gradient-to-r from-pink-600 to-pink-700 hover:from-pink-700 hover:to-pink-800 px-6 py-3 rounded-lg font-semibold transition-all transform hover:scale-105">
          ðŸŽµ Synthesize Multilingual
        </button>
      </div>
    </div>

    <!-- Console Log -->
    <div class="bg-slate-800 rounded-lg p-6 border border-slate-700">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-xl font-bold">Console Log</h2>
        <button id="clear-log" class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-sm transition-colors">
          Clear
        </button>
      </div>
      <div id="console" class="bg-slate-900 rounded-lg p-4 h-64 overflow-y-auto font-mono text-sm space-y-1"></div>
    </div>

    <!-- Audio Players -->
    <div class="grid grid-cols-2 gap-4 mt-6">
      <div class="bg-slate-800 rounded-lg p-4 border border-slate-700">
        <h3 class="font-semibold mb-2 text-purple-400">Sentiment Audio</h3>
        <audio id="sentiment-audio" controls class="w-full"></audio>
      </div>
      <div class="bg-slate-800 rounded-lg p-4 border border-slate-700">
        <h3 class="font-semibold mb-2 text-pink-400">Multilingual Audio</h3>
        <audio id="multilingual-audio" controls class="w-full"></audio>
      </div>
    </div>
  </div>

  <script>
    const SERVER_URL = 'wss://ttsfast.dextora.org';

    // Audio buffers
    const audioBuffers = {
      sentiment: [],
      multilingual: []
    };

    // Console logging
    function log(message, type = 'info') {
      const consoleEl = document.getElementById('console');
      const timestamp = new Date().toLocaleTimeString();
      const colors = {
        info: 'text-slate-300',
        success: 'text-green-400',
        error: 'text-red-400',
        warning: 'text-yellow-400',
        sentiment: 'text-purple-400',
        multilingual: 'text-pink-400'
      };

      const logEntry = document.createElement('div');
      logEntry.className = colors[type] || colors.info;
      logEntry.textContent = `[${timestamp}] ${message}`;
      consoleEl.appendChild(logEntry);
      consoleEl.scrollTop = consoleEl.scrollHeight;
    }

    // Update status indicator
    function updateStatus(namespace, connected) {
      const statusEl = document.getElementById(`${namespace}-status`);
      statusEl.className = `w-3 h-3 rounded-full ${connected ? 'bg-green-500' : 'bg-red-500'}`;
    }

    // Create Socket.IO connections
    const sentimentSocket = io(`${SERVER_URL}/sentiment`, {
      transports: ['websocket', 'polling']
    });

    const multilingualSocket = io(`${SERVER_URL}/multilingual`, {
      transports: ['websocket', 'polling']
    });

    // Sentiment Socket Handlers
    sentimentSocket.on('connect', () => {
      log('Connected to Sentiment socket', 'sentiment');
      updateStatus('sentiment', true);
    });

    sentimentSocket.on('disconnect', () => {
      log('Disconnected from Sentiment socket', 'error');
      updateStatus('sentiment', false);
    });

    sentimentSocket.on('status', (data) => {
      log(`[Sentiment] Status: ${JSON.stringify(data)}`, 'sentiment');
    });

    sentimentSocket.on('translation', (data) => {
      log(`[Sentiment] Translation: ${JSON.stringify(data)}`, 'sentiment');
    });

    sentimentSocket.on('stream_start', () => {
      log('[Sentiment] Stream started', 'sentiment');
      audioBuffers.sentiment = [];
    });

    sentimentSocket.on('audio_chunk', (data) => {
      log(`[Sentiment] Received chunk ${data.chunk_index} (${data.audio ? data.audio.length : 0} bytes)`, 'sentiment');
      if (data.audio) {
        audioBuffers.sentiment.push(data.audio);
      }
    });

    sentimentSocket.on('stream_complete', () => {
      log('[Sentiment] Stream complete âœ“', 'success');
      createAudioBlob('sentiment');
    });

    sentimentSocket.on('error', (data) => {
      log(`[Sentiment] Error: ${JSON.stringify(data)}`, 'error');
    });

    sentimentSocket.on('connect_error', (error) => {
      log(`[Sentiment] Connection error: ${error.message}`, 'error');
    });

    // Multilingual Socket Handlers
    multilingualSocket.on('connect', () => {
      log('Connected to Multilingual socket', 'multilingual');
      updateStatus('multilingual', true);
    });

    multilingualSocket.on('disconnect', () => {
      log('Disconnected from Multilingual socket', 'error');
      updateStatus('multilingual', false);
    });

    multilingualSocket.on('status', (data) => {
      log(`[Multilingual] Status: ${JSON.stringify(data)}`, 'multilingual');
    });

    multilingualSocket.on('stream_start', () => {
      log('[Multilingual] Stream started', 'multilingual');
      audioBuffers.multilingual = [];
    });

    multilingualSocket.on('audio_chunk', (data) => {
      log(`[Multilingual] Received chunk ${data.chunk_index} (${data.audio ? data.audio.length : 0} bytes)`, 'multilingual');
      if (data.audio) {
        audioBuffers.multilingual.push(data.audio);
      }
    });

    multilingualSocket.on('stream_complete', () => {
      log('[Multilingual] Stream complete âœ“', 'success');
      createAudioBlob('multilingual');
    });

    multilingualSocket.on('error', (data) => {
      log(`[Multilingual] Error: ${JSON.stringify(data)}`, 'error');
    });

    multilingualSocket.on('connect_error', (error) => {
      log(`[Multilingual] Connection error: ${error.message}`, 'error');
    });

    // Create audio blob from chunks
    function createAudioBlob(namespace) {
      if (audioBuffers[namespace].length === 0) {
        log(`[${namespace}] No audio data received`, 'warning');
        return;
      }

      // Convert array of buffers to Uint8Array
      const totalLength = audioBuffers[namespace].reduce((sum, chunk) => {
        return sum + (chunk instanceof Uint8Array ? chunk.length : chunk.byteLength || 0);
      }, 0);

      const combinedArray = new Uint8Array(totalLength);
      let offset = 0;

      audioBuffers[namespace].forEach(chunk => {
        const uint8Array = chunk instanceof Uint8Array ? chunk : new Uint8Array(chunk);
        combinedArray.set(uint8Array, offset);
        offset += uint8Array.length;
      });

      // Create blob and set to audio player
      const blob = new Blob([combinedArray], { type: 'audio/wav' });
      const url = URL.createObjectURL(blob);
      const audioEl = document.getElementById(`${namespace}-audio`);
      audioEl.src = url;

      log(`[${namespace}] Audio ready (${(blob.size / 1024).toFixed(2)} KB)`, 'success');
    }

    // Button handlers
    document.getElementById('sentiment-btn').addEventListener('click', () => {
      const text = document.getElementById('sentiment-text').value;
      const language = document.getElementById('sentiment-lang').value;

      if (!text) {
        log('Please enter text for sentiment synthesis', 'warning');
        return;
      }

      log(`Sending sentiment request: "${text}" (${language})`, 'info');
      sentimentSocket.emit('synthesize', { text, language });
    });

    document.getElementById('multilingual-btn').addEventListener('click', () => {
      const text = document.getElementById('multilingual-text').value;
      const language = document.getElementById('multilingual-lang').value;

      if (!text) {
        log('Please enter text for multilingual synthesis', 'warning');
        return;
      }

      log(`Sending multilingual request: "${text}" (${language})`, 'info');
      multilingualSocket.emit('synthesize', { text, language });
    });

    document.getElementById('clear-log').addEventListener('click', () => {
      document.getElementById('console').innerHTML = '';
    });

    // Initial log
    log('Connecting to sockets...', 'info');
  </script>
</body>

</html>